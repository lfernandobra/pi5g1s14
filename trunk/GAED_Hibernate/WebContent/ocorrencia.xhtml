<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<h:head>
	<title>Ocorrencia</title>
	<script src="scripts/scripts.js" type="text/javascript"></script>
	<link rel="stylesheet" href="styles/layout_crud.css" type="text/css" />
</h:head>
<ui:decorate template="/Cabecalho.xhtml">
	<ui:define name="center">

	
	<h2>Lista de Ocorrências</h2>
	
		<div id="Lista">
				<p:separator />
				
				<p:toolbar styleClass="toolbar">
					<f:facet name="left">
						<p:commandButton value="Cadastrar" type="button" onclick="PF('dialogCadastrar').show();" icon="ui-icon-disk" />
					</f:facet>
				</p:toolbar>
			
				<h:form id="formPrincipal">
					<p:growl id="growl" showDetail="true" life="4000" />
					<p:dataTable var="lista" value="#{OcorrenciaBean.ocorrencias}" id="tabelaOcorrencia" resizableColumns="true" reflow="true" rows="5"	emptyMessage="Nenhum registro encontrado" paginator="true"
						paginatorPosition="bottom" styleClass="dataTablePrincipal">
		
						<f:facet name="header">Lista de Ocorrencia 	</f:facet>
						
						<p:column style="width:16px">
							<p:rowToggler />
						</p:column>
						<p:column headerText="ID" sortBy="#{lista.id}"
							filterBy="#{lista.id}">
							<h:outputText value="#{lista.id}" />
						</p:column>
						<p:column headerText="Assunto" sortBy="#{lista.assunto}"
							filterBy="#{lista.assunto}">
							<h:outputText value="#{lista.assunto}" />
						</p:column>
						<p:rowExpansion>
							<p:panelGrid columns="2" columnClasses="label,value">
								<h:outputText value="Conteúdo" />
								<h:outputText value="#{lista.descricao}" />
							</p:panelGrid>
						</p:rowExpansion>
		
						<p:column headerText="Ações">
							<p:commandButton value="Alterar" update=":formAlterar" oncomplete="PF('dialogAlterar').show();" icon="ui-icon-pencil">
								<f:setPropertyActionListener target="#{OcorrenciaBean.ocorrencia}"
									value="#{lista}" />
							</p:commandButton>
		
							<p:commandButton value="Excluir" actionListener="#{OcorrenciaBean.excluir(lista)}" update=":formPrincipal:tabelaOcorrencia" icon="ui-icon-closethick">
								<p:confirm header="Excluir Ocorrencia" message="Deseja excluir?" icon="ui-icon-alert" />
							</p:commandButton>
							<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
								<p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</p:confirmDialog>
						</p:column>

						<f:facet name="footer">Total cadastrado #{fn:length(OcorrenciaBean.ocorrencias)} ocorrencias</f:facet>
					</p:dataTable>
				</h:form>
		
				<p:dialog header="Formulario de Cadastro de ocorrência" widgetVar="dialogCadastrar" modal="true" resizable="true" id="formCadMedio" appendTo="@(body)" closeOnEscape="true" closable="true" maximizable="true"   >
					<p:growl id="growl" showDetail="true" life="4000" />		
						<h:form id="formCadastrar" styleClass="formCadastrar">
						<p:focus context="@form" />
							<h:outputText value="Campos obrigatórios * " style="font-size: 10px !important; top: 5px !important 	" />	
							
							<h3>Dados da ocorrência</h3>
							<p:separator/>
						
						<p:panelGrid id="panelBusca" columns="4">
							<p:outputLabel for="turma" value="Turma: " />
				            <p:selectOneMenu id="turma" value="#{OcorrenciaBean.turmas}" required="true">  
				                <f:selectItem itemLabel="Selecione a turma" itemValue="" />  
				                <f:selectItems value="#{TurmaBean.turmas}" var="turma"	itemValue="#{turma}" itemLabel="#{turma.nome}" />  
				                <p:ajax update="alunos" listener="#{OcorrenciaBean.handleTurmaChange()}" />
				                <f:converter converterId="turmaConverter" />  
				            </p:selectOneMenu>  
				  
				  			<p:outputLabel for="alunos" value="Aluno: " />
				            <p:selectOneMenu id="alunos" value="#{OcorrenciaBean.aluno}" required="true">  
				                <f:selectItem itemLabel="Selecione o aluno " itemValue="" />  
				                <f:selectItems value="#{OcorrenciaBean.aluno}" />  
				            </p:selectOneMenu> 
						</p:panelGrid>				
						
						<p:panelGrid id="panelCadastrar" columns="1">
							<p:outputLabel for="assunto" value="Assunto:" />
							<p:inputText value="#{OcorrenciaBean.ocorrencia.assunto}" size="80" required="true" id="assunto" requiredMessage="Assunto não deve estar vazio!" />
							
							<p:outputLabel for="data" value="Data:" />
							<p:inputMask value="#{OcorrenciaBean.ocorrencia.data}" mask="99/99/9999" placeholder="dd/mm/aaaa" required="true"	label="data" id="data"
								requiredMessage="Data de nascimento deve ser informada!">
								<f:converter converterId="javax.faces.DateTime" />
								<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
							</p:inputMask>
							
							<p:outputLabel for="descricao" value="Descrição:" />
							<p:editor  widgetVar="editorWidget" value="#{OcorrenciaBean.ocorrencia.descricao}" width="700"  id="descricao" />
						</p:panelGrid>
						
						<div id="botoes">
							<p:commandButton value="Salvar" id="withIcon" actionListener="#{OcorrenciaBean.cadastrar}" icon="ui-icon-disk"
								update=":formPrincipal:tabelaOcorrencia @form growl" oncomplete="closeDialogIfSucess(xhr, status, args, 'dialogCadastrar','formCad')"
								onsuccess="PF('dialogCadastrar').hide();" />
								
							<p:commandButton value="Limpar" update="@form" process="@this">
								<p:resetInput target="panelCadastrar panelBusca" />
							</p:commandButton>
						</div>
						
					</h:form>
				</p:dialog>
				
				<p:dialog header="Alterar" widgetVar="dialogAlterar" modal="true" resizable="true" id="formAltMedio" appendTo="@(body)">
					<h:form id="formAlterar" styleClass="formAlterar">
						<p:focus context="@form" />
						<p:growl id="growl" showDetail="true" life="4000" />
						<h:outputText value="Campos obrigatórios * " style="font-size: 10px !important; top: 5px !important" />	
						
						<h3>Dados da ocorrência</h3>
						<p:separator/>
									
						<h:inputHidden value="#{OcorrenciaBean.ocorrencia}" />
						<p:panelGrid id="panelAlterar" columns="2">
							<p:outputLabel for="assunto" value="Assunto:" />
							<p:inputText value="#{OcorrenciaBean.ocorrencia.assunto}" required="true" id="assunto"	requiredMessage="Nome não deve estar vazio!" />
							
							<p:outputLabel for="data" value="Data:" />
							<p:inputMask value="#{OcorrenciaBean.ocorrencia.data}" mask="99/99/9999" placeholder="dd/mm/aaaa" required="true"	label="data" id="data"
								requiredMessage="Data de nascimento deve ser informada!">
								<f:converter converterId="javax.faces.DateTime" />
								<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
							</p:inputMask>
							
							<p:outputLabel for="descricao" value="Descrição:" />
							<p:inputText  widgetVar="editorWidget"  value="#{OcorrenciaBean.ocorrencia.descricao}"   width="700" id="descricao" />
			
							
						</p:panelGrid>
		
						<p:commandButton value="Salvar" id="withIcon" actionListener="#{OcorrenciaBean.alterar}" icon="ui-icon-disk" update=":formPrincipal:tabelaOcorrencia @form"
							oncomplete="closeDialogIfSucess(xhr, status, args, 'dialogAlterar','formAlt')" onsuccess="PF('dialogAlterar').hide();" />
						
						<p:commandButton value="Limpar" update="@form" process="@this">
							<p:resetInput target="panelAlterar" />
						</p:commandButton>
					</h:form>
				</p:dialog>
		
		
		
	</div>
</ui:define>
</ui:decorate>
</html>