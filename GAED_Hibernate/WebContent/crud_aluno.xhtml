<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
	<title>Aluno</title>
</h:head>
<body>
	<div align="center">
		<h:form id="formPrincipal">
			<p:dataTable var="aluno" value="#{AlunoBean.alunos}"
				id="tabelaAluno" resizableColumns="true" reflow="true"
				rows="5" paginator="true">
				<f:facet name="header">Lista de Alunos
					<p:commandButton id="toggler" type="button" value="Colunas"
						style="float:right" icon="ui-icon-calculator" />
						<p:columnToggler datasource="tabelaAluno" trigger="toggler" />

				</f:facet>
				<p:column style="width:16px">
					<p:rowToggler />
				</p:column>
				<p:column headerText="ID" sortBy="#{aluno.id}" filterBy="#{aluno.id}">
					<h:outputText value="#{aluno.id}" />
				</p:column>
				<p:column headerText="Nome Completo" sortBy="#{aluno.nome}" filterBy="#{aluno.nome}">
					<h:outputText value="#{aluno.nome} #{aluno.sobrenome}" />
				</p:column>
				<p:column headerText="CPF" sortBy="#{aluno.CPF}" filterBy="#{aluno.CPF}">
					<h:outputText value="#{aluno.CPF}" />
				</p:column>
				<p:column headerText="RG" sortBy="#{aluno.RG}" filterBy="#{aluno.RG}">
					<h:outputText value="#{aluno.RG}" />
				</p:column>
				<p:column headerText="Sexo" sortBy="#{aluno.sexo}" filterBy="#{aluno.sexo}">
					<h:outputText value="#{aluno.sexo}" />
				</p:column>
				<p:rowExpansion>
					<p:panelGrid columns="2" columnClasses="label,value">
						<h:outputText value="Data de nascimento " />
						<h:outputText value="#{aluno.datanasc}" />
						<h:outputText value="Sexo " />
						<h:outputText value="#{aluno.sexo}" />
						<h:outputText value="Endereço " />
						<h:outputText
							value="#{aluno.logradouro.nome} 
											 #{aluno.numero} 
											 #{aluno.logradouro.bairro.nome}
											 #{aluno.logradouro.bairro.municipio.nome}
											 #{aluno.logradouro.bairro.municipio.uf.nome}
											 #{aluno.complemento}
											 #{aluno.logradouro.CEP}" />
						<h:outputText value="E-mail " />
						<h:outputText value="#{aluno.email}" />
						<h:outputText value="Telefone " />
						<h:outputText value="#{aluno.telefone}" />
						<h:outputText value="CPF " />
						<h:outputText value="#{aluno.CPF}" />
						<h:outputText value="RG " />
						<h:outputText value="#{aluno.RG}" />
						<h:outputText value="Data de Ingresso: " />
						<h:outputText value="#{aluno.dataIngresso}" />
						<h:outputText value="Data de Saida: " />
						<h:outputText value="#{aluno.dataSaida}" />
						<h:outputText value="Escola atual: " />
						<h:outputText value="#{aluno.escolaAtual}" />
						<h:outputText value="Escola anterior: " />
						<h:outputText value="#{aluno.escolaAnterior}" />
					</p:panelGrid>
				</p:rowExpansion>
				<p:column headerText="Ações">

					<!-- Alterar -->
					<p:commandButton value="Alterar" update=":formAlterar:Alterar"
						oncomplete="PF('dialogAlterar').show();" icon="ui-icon-pencil">
						<f:setPropertyActionListener
							target="#{AlunoBean.aluno}" value="#{aluno}" />
					</p:commandButton>


					<!-- Excluir -->
					<p:commandButton value="Excluir"
						actionListener="#{AlunoBean.excluir(aluno)}"
						update=":formPrincipal:tabelaAluno"
						icon="ui-icon-closethick">
						<p:confirm header="Excluir Aluno" message="Deseja excluir?"
							icon="ui-icon-alert" />
					</p:commandButton>
					<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
						<p:commandButton value="Sim" type="button"
							styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
						<p:commandButton value="Não" type="button"
							styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
					</p:confirmDialog>

				</p:column>

			</p:dataTable>
		</h:form>
		<h:panelGrid columns="1" cellpadding="5">
			<p:commandButton value="Cadastrar" type="button"
				onclick="PF('dialogCadastrar').show();" icon="ui-icon-disk" />
		</h:panelGrid>
		
		<p:dialog
                    modal="true"
                    appendTo="@(body)"
                    widgetVar="dlgcriar"
                    width="500"
                    height="450"
                    resizable="false"
                    closable="true"
                    closeOnEscape="true"
                    >

                    <h:form id="criar">
                        <p:focus context="@form"/>
                        <p:messages closable="true" autoUpdate="true"/>
                        <p:panelGrid columns="2" styleClass="semBorda">
                            <p:graphicImage height="100"
                                            width="100"
                                            id="pic"
                                            url="#{usuarioBean.retornaFoto()}"/>         
                            <h:outputText value="."   rendered="#{usuarioBean.ver eq false}"/>
                            <p:commandButton onclick="PF('dlgfoto').show();"
                                             update=":foto"
                                             id="foto"
                                             rendered="#{usuarioBean.ver eq false}"
                                             immediate="true"
                                             value="foto"
                                             onstart="PF('statusDialog').show()" 
                                             onsuccess="PF('statusDialog').hide();"
                                             style="width: 100px"
                                             />
                            <h:outputText value="."/>

                            <p:outputLabel value="Codigo:" rendered="#{usuarioBean.usuario.id ne null}"/>
                            <h:outputText value="#{usuarioBean.usuario.id}"  rendered="#{usuarioBean.usuario.id ne null}"/>

                            <p:outputLabel value="Usuario:" for="usuario"/>
                            <p:inputText value="#{usuarioBean.usuario.usuario}"
                                         maxlength="32"
                                         required="true"
                                         id="usuario"
                                         disabled="#{usuarioBean.ver}"
                                         placeholder="usuario"
                                         requiredMessage="preencha o campo usuario"/>

                            <p:outputLabel value="Senha:" for="senha" rendered="#{usuarioBean.usuario.id eq null}"/>
                            <p:password value="#{usuarioBean.usuario.senha}"
                                        required="true"
                                        id="senha"
                                        disabled="#{usuarioBean.ver}"
                                        rendered="#{usuarioBean.usuario.id eq null}"
                                        requiredMessage="preencha o campo senha"
                                        feedback="true"
                                        promptLabel="digite a senha"
                                        placeholder="senha"
                                        goodLabel="senha boa"
                                        weakLabel="senha fraca"
                                        strongLabel="senha forte"
                                        maxlength="32"/>


                            <p:outputLabel value="Email:" for="email"/>
                            <p:inputText value="#{usuarioBean.usuario.email}"
                                         maxlength="64"
                                         size="40"
                                         required="true"
                                         id="email"
                                         disabled="#{usuarioBean.ver}"
                                         placeholder="email"
                                         requiredMessage="preencha o campo email"
                                         validatorMessage="email invalido">
                                <f:validateRegex pattern="([^.@]+)(\.[^.@]+)*@([^.@]+\.)+([^.@]+)" />
                            </p:inputText>

                            <p:outputLabel value="Status:" for="status" rendered="#{session.getAttribute('usuarioLogado').nivel eq 'SUPER' or session.getAttribute('usuarioLogado').nivel eq 'ADMINISTRADOR'}"/>
                            <p:selectOneMenu id='status'
                                             value="#{usuarioBean.usuario.status}"
                                             required="true"
                                             rendered="#{session.getAttribute('usuarioLogado').nivel eq 'SUPER' or session.getAttribute('usuarioLogado').nivel eq 'ADMINISTRADOR'}"
                                             disabled="#{usuarioBean.ver}"
                                             requiredMessage="selecione o status">
                                <f:selectItem itemLabel="selecione..."/>
                                <f:selectItem itemValue="A" itemLabel="Ativo"/>
                                <f:selectItem itemValue="I" itemLabel="Inativo"/>
                                <f:selectItem itemValue="B" itemLabel="Bloqueado"/>
                            </p:selectOneMenu>

                            <p:outputLabel value="Nivel:" for="nivel"  rendered="#{session.getAttribute('usuarioLogado').nivel ne 'USUARIO'}"/>
                            <p:selectOneMenu id='nivel'
                                             rendered="#{session.getAttribute('usuarioLogado').nivel ne 'USUARIO'}"
                                             disabled="#{usuarioBean.ver}"
                                             value="#{usuarioBean.usuario.nivel}"
                                             required="true"
                                             requiredMessage="selecione o nivel">
                                <f:selectItem itemLabel="selecione..."/>
                                <f:selectItem itemValue="ADMINISTRADOR" itemLabel="ADMINISTRADOR"  />
                                <f:selectItem itemValue="USUARIO" itemLabel="USUARIO"/>
                            </p:selectOneMenu>

                            <p:outputLabel value="Data Cadastro:" rendered="#{usuarioBean.ver}"  />
                            <h:outputText value="#{usuarioBean.usuario.dataCadastro}" rendered="#{usuarioBean.ver}" >
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                            </h:outputText>

                            <p:outputLabel value="Data Alteracao:"  rendered="#{usuarioBean.ver}" />
                            <h:outputText value="#{usuarioBean.usuario.dataAlteracao}" rendered="#{usuarioBean.ver}" >
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                            </h:outputText>

                            <p:outputLabel value="Usuario Alteracao:" rendered="#{usuarioBean.ver}" />
                            <h:outputText value="#{util.nomeUsuario(usuarioBean.usuario.usuarioAlteracao)}" rendered="#{usuarioBean.ver}" />

                            <p:commandButton value="salvar"
                                             rendered="#{usuarioBean.ver eq false}"
                                             actionListener="#{usuarioBean.salvar()}"
                                             update="@form"
                                             onstart="PF('statusDialog').show()" 
                                             onsuccess="PF('statusDialog').hide();"
                                             style="width: 100px">
                                <p:confirm header="Confirmação" message="Tem certeza?" icon="ui-icon-alert" />
                            </p:commandButton>

                            <p:commandButton value="cancelar"
                                             update="@form"
                                             rendered="#{usuarioBean.ver eq false}"
                                             immediate="true"
                                             oncomplete="PF('dlgcriar').hide();"
                                             onstart="PF('statusDialog').show()" 
                                             onsuccess="PF('statusDialog').hide();"
                                             style="width: 100px">
                                <p:confirm header="Confirmação" message="Tem certeza?" icon="ui-icon-alert" />
                            </p:commandButton>

                        </p:panelGrid>


                    </h:form>

                </p:dialog>
		
		
		
		<h:form>
			<p:dialog header="Cadastrar Aluno" widgetVar="dialogCadastrar"
				modal="true" resizable="true">

				<p:panelGrid id="panelCadastrar" columns="2">
					<h:outputText value="Login:" />
					<p:inputText value="#{AlunoBean.aluno.login}" />
					<h:outputText value="Senha:" />
					<p:password value="#{AlunoBean.aluno.senha}" />
					<h:outputText value="Nome:" />
					<p:inputText value="#{AlunoBean.aluno.nome}" />
					<h:outputText value="Sobrenome:" />
					<p:inputText value="#{AlunoBean.aluno.sobrenome}" />
					<h:outputText value="Sexo:" />
					<p:selectOneMenu id="sexo"
						value="#{AlunoBean.aluno.sexo}" style="width:150px">
						<f:selectItem itemLabel="Masculino" itemValue="Masculino" />
						<f:selectItem itemLabel="Feminino" itemValue="Feminino" />
					</p:selectOneMenu>
					<h:outputText value="Data de Nascimento: " />
					<p:inputMask id="dataNascimento"
						value="#{AlunoBean.aluno.datanasc}" mask="99/99/9999"
						placeholder="dd/mm/aaaa">
						<f:converter converterId="javax.faces.DateTime" />
						<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
					</p:inputMask>

					<h:outputText value="Logradouro:" />
					<p:autoComplete value="#{AlunoBean.aluno.logradouro}"
						completeMethod="#{LogradouroBean.completeLogradouro()}"
						var="logradouro" itemLabel="#{logradouro.CEP}"
						itemValue="#{logradouro}" forceSelection="true">
					</p:autoComplete>
					<h:outputText value="Número:" />
					<p:inputText value="#{AlunoBean.aluno.numero}" />
					<h:outputText value="Complemento:" />
					<p:inputText value="#{AlunoBean.aluno.complemento}" />
					<h:outputText value="Telefone:" />
					<p:inputMask id="phoneWithExt"
						value="#{AlunoBean.aluno.telefone}"
						mask="(99) 99999-9999" />
					<h:outputText value="E-mail:" />
					<p:inputText id="email" required="true" label="email" size="40"
						requiredMessage="Please enter your email address."
						validatorMessage="Invalid email format"
						value="#{AlunoBean.aluno.email}">
						<f:validateRegex
							pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
					</p:inputText>
					<h:outputText value="CPF:" />
					<p:inputMask id="CPFId" value="#{AlunoBean.aluno.CPF}"
						mask="999999999-99" />
					<h:outputText value="RG:" />
					<p:inputMask id="RGId" value="#{AlunoBean.aluno.RG}"
						mask="99999999-9" />

					<h:outputText value="Data de Ingresso: " />
					<p:inputMask id="dataIngresso"
						value="#{AlunoBean.aluno.dataIngresso}"
						mask="99/99/9999" placeholder="dd/mm/aaaa">
						<f:converter converterId="javax.faces.DateTime" />
						<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
					</p:inputMask>

					<h:outputText value="Data de Saida: " />
					<p:inputMask id="dataSaida"
						value="#{AlunoBean.aluno.dataSaida}" mask="99/99/9999"
						placeholder="dd/mm/aaaa">
						<f:converter converterId="javax.faces.DateTime" />
						<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
					</p:inputMask>
					
					<h:outputText value="Escola anterior:" />
					<p:inputText value="#{AlunoBean.aluno.escolaAnterior}" />
					
					<h:outputText value="Série anterior:" />
					<p:inputText value="#{AlunoBean.aluno.serieAnterior}" />
					
					<h:outputText value="Escola atual:" />
					<p:inputText value="#{AlunoBean.aluno.escolaAtual}" />
					
					<h:outputText value="Série atual:" />
					<p:inputText value="#{AlunoBean.aluno.serieAtual}" />
					
					<p:commandButton value="Salvar" id="withIcon"
						actionListener="#{AlunoBean.cadastrar}" icon="ui-icon-disk"
						update=":formPrincipal:tabelaAluno"
						oncomplete="PF('dialogCadastrar').hide();" />
					<p:commandButton value="Limpar" update="panelCadastrar"
						process="@this">
						<p:resetInput target="panelCadastrar" />
					</p:commandButton>
				</p:panelGrid>
			</p:dialog>
		</h:form>
	</div>
	<h:form id="formAlterar">
		<p:dialog header="Alterar Aluno" widgetVar="dialogAlterar"
			modal="true" resizable="true" id="Alterar">

			<h:inputHidden value="#{AlunoBean.aluno}" />
			<p:panelGrid id="panelAlterar" columns="2">
				<h:outputText value="Login:" />
				<p:inputText value="#{AlunoBean.aluno.login}" />
				<h:outputText value="Senha:" />
				<p:password value="#{AlunoBean.aluno.senha}" />
				<h:outputText value="Nome:" />
				<p:inputText value="#{AlunoBean.aluno.nome}" />
				<h:outputText value="Sobrenome:" />
				<p:inputText value="#{AlunoBean.aluno.sobrenome}" />
				<h:outputText value="Sexo:" />
				<p:selectOneMenu id="sexo"
					value="#{AlunoBean.aluno.sexo}" style="width:150px">
					<f:selectItem itemLabel="Masculino" itemValue="Masculino" />
					<f:selectItem itemLabel="Feminino" itemValue="Feminio" />
				</p:selectOneMenu>
				<h:outputText value="Data de Nascimento: " />
				<p:inputMask id="dataNascimento"
					value="#{AlunoBean.aluno.datanasc}" mask="99/99/9999"
					placeholder="Dia/Mês/Ano">
					<f:converter converterId="javax.faces.DateTime" />
					<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
				</p:inputMask>

				<h:outputText value="Logradouro:" />
				<p:autoComplete value="#{AlunoBean.aluno.logradouro}"
					completeMethod="#{LogradouroBean.completeLogradouro()}"
					var="logradouro" itemLabel="#{logradouro.CEP}"
					itemValue="#{logradouro}" forceSelection="true">
				</p:autoComplete>
				<h:outputText value="Número:" />
				<p:inputText value="#{AlunoBean.aluno.numero}" />
				<h:outputText value="Complemento:" />
				<p:inputText value="#{AlunoBean.aluno.complemento}" />
				<h:outputText value="Telefone:" />
				<p:inputMask id="phoneWithExt"
					value="#{AlunoBean.aluno.telefone}"
					mask="(99) 99999-9999" />
				<h:outputText value="E-mail:" />
				<p:inputText id="email" required="true" label="email" size="40"
					requiredMessage="Please enter your email address."
					validatorMessage="Invalid email format"
					value="#{AlunoBean.aluno.email}">
					<f:validateRegex
						pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
				</p:inputText>
				<h:outputText value="CPF:" />
				<p:inputMask id="CPFId" value="#{AlunoBean.aluno.CPF}"
					mask="999999999-99" />
				<h:outputText value="RG:" />
				<p:inputMask id="RGId" value="#{AlunoBean.aluno.RG}"
					mask="99999999-9" />

				<h:outputText value="Data de Ingresso: " />
				<p:inputMask id="dataIngresso"
					value="#{AlunoBean.aluno.dataIngresso}"
					mask="99/99/9999" placeholder="Dia/Mês/Ano">
					<f:converter converterId="javax.faces.DateTime" />
					<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
				</p:inputMask>

				<h:outputText value="Data de Saida: " />
				<p:inputMask id="dataSaida"
					value="#{AlunoBean.aluno.dataSaida}" mask="99/99/9999"
					placeholder="Dia/Mês/Ano">
					<f:converter converterId="javax.faces.DateTime" />
					<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
				</p:inputMask>

				<h:outputText value="Escola anterior:" />
				<p:inputText value="#{AlunoBean.aluno.escolaAnterior}" />

				<h:outputText value="Série anterior:" />
				<p:inputText value="#{AlunoBean.aluno.serieAnterior}" />

				<h:outputText value="Escola atual:" />
				<p:inputText value="#{AlunoBean.aluno.escolaAtual}" />

				<h:outputText value="Série atual:" />
				<p:inputText value="#{AlunoBean.aluno.serieAtual}" />

				<p:commandButton value="Alterar"
					actionListener="#{AlunoBean.alterar}"
					update=":formPrincipal:tabelaAluno"
					oncomplete="PF('dialogAlterar').hide();" />
				<p:commandButton value="Limpar" update="panelAlterar"
					process="@this">
					<p:resetInput target="panelAlterar" />
				</p:commandButton>
			</p:panelGrid>


		</p:dialog>
	</h:form>
</body>
</html>